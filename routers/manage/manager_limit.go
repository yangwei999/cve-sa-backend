package routers

import (
	"time"

	"github.com/gin-gonic/gin"

	"cve-sa-backend/utils/tools"
)

var lastAccessTime = make(map[string]time.Time)

func managerLimit(c *gin.Context) {
	remoteIp := c.ClientIP()
	now := time.Now()

	if last, ok := lastAccessTime[remoteIp]; ok {
		if now.Sub(last) <= time.Second*30 {
			c.Abort()
			tools.Failure(c, "visit too often")
			return
		}
	}

	lastAccessTime[remoteIp] = now

	c.Next()
}
